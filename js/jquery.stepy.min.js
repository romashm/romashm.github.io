/*!
 * jQuery Stepy - A Wizard Plugin
 *
 * Licensed under The MIT License
 *
 * @version        1.1.0
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/stepy
 *
 */

!function(t){var e={init:function(i){return this.each(function(){var a=t.extend({},t.fn.stepy.defaults,i),n=t(this).data("options",a),s=n.attr("id");void 0!==s&&""!=s||(s="stepy-"+t("."+n.attr("class")).index(this),n.attr("id",s));var r=t("<ul/>",{id:s+"-titles",class:"stepy-titles"});a.titleTarget?t(a.titleTarget).html(r):r.insertBefore(n),a.validate&&(jQuery.validator.setDefaults({ignore:a.ignore}),n.append('<div class="stepy-error"/>'));var l=n.children("fieldset"),c=void 0,o=void 0,d="",h="";l.each(function(i){(c=t(this)).addClass("step").attr("id",s+"-step-"+i).append('<p id="'+s+"-buttons-"+i+'" class="'+s+'-buttons"/>'),o=c.children("legend"),a.legend||o.hide(),d="",a.description&&(o.length?d="<span>"+o.html()+"</span>":t.error(s+": the legend element of the step "+(i+1)+" is required to set the description!")),h=""!=(h=c.attr("title"))?"<div>"+h+"</div>":"--",r.append('<li id="'+s+"-title-"+i+'">'+h+d+"</li>"),0==i?l.length>1&&e.createNextButton.call(n,i):(e.createBackButton.call(n,i),c.hide(),i<l.length-1&&e.createNextButton.call(n,i))});var u=r.children();u.first().addClass("current-step");var f=n.children(".finish");if(a.finishButton)if(f.length){var p=n.is("form"),v=void 0;a.finish&&p&&(v=n.attr("onsubmit"),n.attr("onsubmit","return false;")),f.click(function(t){a.finish&&!e.execute.call(n,a.finish,l.length-1)?t.preventDefault():p&&(v?n.attr("onsubmit",v):n.removeAttr("onsubmit"),"submit"==f.attr("type")||a.validate&&!e.validate.call(n,l.length-1)||n.submit())}),f.appendTo(n.find("p:last"))}else t.error(s+': element with class name "finish" missing!');a.titleClick?u.click(function(){var i=u.filter(".current-step").attr("id").split("-"),s=parseInt(i[i.length-1],10),r=t(this).index();if(r>s){if(a.next&&!e.execute.call(n,a.next,r))return!1}else if(r<s&&a.back&&!e.execute.call(n,a.back,r))return!1;r!=s&&e.step.call(n,r+1)}):u.css("cursor","default"),l.delegate('input[type="text"], input[type="password"]',"keypress",function(e){if(13==(e.keyCode?e.keyCode:e.which)){e.preventDefault();var i=t(this).parent().children("."+s+"-buttons");if(i.length){var a=i.children(".button-next");if(a.length)a.click();else{var n=i.children(".finish");n.length&&n.click()}}}})})},createBackButton:function(i){var a=this,n=this.attr("id"),s=this.data("options");t("<a/>",{id:n+"-back-"+i,href:"javascript:void(0);",class:"button-back",html:s.backLabel}).click(function(){s.back&&!e.execute.call(a,s.back,i-1)||e.step.call(a,i-1+1)}).appendTo(t("#"+n+"-buttons-"+i))},createNextButton:function(i){var a=this,n=this.attr("id"),s=this.data("options");t("<a/>",{id:n+"-next-"+i,href:"javascript:void(0);",class:"button-next",html:s.nextLabel}).click(function(){s.next&&!e.execute.call(a,s.next,i+1)||e.step.call(a,i+1+1)}).appendTo(t("#"+n+"-buttons-"+i))},execute:function(t,e){var i=t.call(this,e+1);return i||void 0===i},step:function(i){i--;var a=this.children("fieldset");i>a.length-1&&(i=a.length-1);var n=this.data("options");if(max=i,n.validate)for(var s=!0,r=0;r<i;r++)if(s&=e.validate.call(this,r),n.block&&!s){max=r;break}if(a.hide().eq(max).show(),t("#"+this.attr("id")+"-titles").children().removeClass("current-step").eq(max).addClass("current-step"),this.is("form")){(max==i?a.eq(max).find(":input:enabled:visible"):a.eq(max).find(".error").select().focus()).first().select().focus()}return n.select&&n.select.call(this,max+1),this},validate:function(e){if(!this.is("form"))return!0;var i=this.children("fieldset").eq(e),a=!0,n=t("#"+this.attr("id")+"-titles").children().eq(e),s=this.data("options"),r=this.validate();return t(i.find(":input:enabled").get().reverse()).each(function(){var e=r.element(t(this));void 0===e&&(e=!0),(a&=e)?s.errorImage&&n.removeClass("error-image"):(s.errorImage&&n.addClass("error-image"),r.focusInvalid())}),a}};t.fn.stepy=function(i){return e[i]?e[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?void t.error("Method "+i+" does not exist!"):e.init.apply(this,arguments)},t.fn.stepy.defaults={back:void 0,backLabel:"&lt; Back",block:!1,description:!0,errorImage:!1,finish:void 0,finishButton:!0,legend:!0,ignore:"",next:void 0,nextLabel:"Next &gt;",titleClick:!1,titleTarget:void 0,validate:!1,select:void 0}}(jQuery);